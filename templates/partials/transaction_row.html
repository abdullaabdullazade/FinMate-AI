<div id="expense-{{ expense.id }}" class="py-2 sm:py-3 border-b border-white/10 rounded-lg transition group">
    <div class="flex items-center justify-between hover:bg-white/5 px-2 py-2 rounded-lg transition cursor-pointer transaction-header"
        data-transaction-id="txn-{{ expense.id }}" data-target="items-txn-{{ expense.id }}" aria-expanded="false">
        <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
            <div class="merchant-logo
                {% if 'Market' in expense.category or 'Bravo' in expense.merchant or 'Araz' in expense.merchant %}category-market
                {% elif 'Restoran' in expense.category or 'KFC' in expense.merchant or 'McDonald' in expense.merchant %}category-restoran
                {% elif 'Kafe' in expense.category or 'Coffee' in expense.merchant or 'Starbucks' in expense.merchant %}category-kafe
                {% elif 'NÉ™qliyyat' in expense.category or 'Bolt' in expense.merchant or 'Uber' in expense.merchant %}category-transport
                {% elif 'Mobil' in expense.category or 'Ä°nternet' in expense.category %}category-mobile
                {% elif 'Kommunal' in expense.category %}category-kommunal
                {% elif 'Geyim' in expense.category or 'AlÄ±ÅŸ-veriÅŸ' in expense.category %}category-shopping
                {% elif 'Online' in expense.category or 'AliExpress' in expense.merchant %}category-online
                {% elif 'ÆylÉ™ncÉ™' in expense.category or 'Netflix' in expense.merchant %}category-entertainment
                {% elif 'AptÉ™k' in expense.category or 'Ä°dman' in expense.category %}category-health
                {% elif 'Bank' in expense.category or 'E-Ã¶dÉ™niÅŸ' in expense.category or 'Kapital' in expense.merchant %}category-bank
                {% else %}bg-gradient-to-br from-gray-400 to-gray-600{% endif %}">
                {{ expense.notes if expense.notes else 'ðŸ’°' }}
            </div>
            <div class="flex-1 min-w-0">
                <p class="text-white font-medium text-sm sm:text-base truncate">{{ expense.merchant }}</p>
                <div class="flex items-center gap-1 sm:gap-2 flex-wrap">
                    <p class="text-xs text-white/60 truncate">{{ expense.category }} â€¢ {{
                        expense.date.strftime('%d.%m.%Y, %H:%M') }}</p>
                    {% if expense.items and expense.items|length > 0 %}
                    <span
                        class="text-xs bg-purple-500/30 text-purple-200 px-1.5 sm:px-2 py-0.5 rounded-full flex-shrink-0">{{
                        expense.items|length }} mÉ™hsul</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="flex items-center gap-1.5 sm:gap-3 flex-shrink-0">
            <span class="text-white font-bold text-sm sm:text-base incognito-hidden">{{ "%.2f"|format(expense.amount) }}
                â‚¼</span>

            <button
                onclick="event.stopPropagation(); window.openEditModal({{ expense.id }}, '{{ expense.merchant }}', {{ expense.amount }}, '{{ expense.category }}')"
                class="transition-opacity text-blue-400 hover:text-blue-300 p-1.5 sm:p-2 rounded-lg hover:bg-blue-500/10 flex-shrink-0"
                title="DÃ¼zÉ™liÅŸ et">
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                    </path>
                </svg>
            </button>

            <button onclick="event.stopPropagation(); openDeleteModal({{ expense.id }});"
                class="transition-opacity text-red-400 hover:text-red-300 p-1.5 sm:p-2 rounded-lg hover:bg-red-500/10 flex-shrink-0"
                title="Sil">
                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                    </path>
                </svg>
            </button>
            {% if expense.items and expense.items|length > 0 %}
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white/50 transition-transform expand-icon flex-shrink-0" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                </path>
            </svg>
            {% endif %}
        </div>
    </div>

    {% if expense.items and expense.items|length > 0 %}
    <div class="transaction-items hidden mt-2 sm:mt-3 pl-0 md:pl-[60px] transition-all duration-300"
        id="items-txn-{{ expense.id }}" data-parent="txn-{{ expense.id }}">
        <div class="bg-white/5 rounded-lg p-2 sm:p-3 text-xs border border-white/10 animate-slideDown">
            <p class="text-white/50 mb-2 font-medium flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                    </path>
                </svg>
                MÉ™hsullar ({{ expense.items|length }})
            </p>
            <ul class="space-y-1.5" id="items-list-txn-{{ expense.id }}">
                {% for item in expense.items %}
                <li class="flex justify-between text-white/70 py-1 border-b border-white/5 last:border-0">
                    <span class="flex-1">{{ loop.index }}. {{ item.name }}</span>
                    <span class="font-medium text-white">{{ "%.2f"|format(item.price) }} â‚¼</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
</div>