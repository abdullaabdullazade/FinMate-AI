{% extends "base.html" %}

{% block title %}Chat - FinMate AI{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="/static/css/chat.css">
<style>
    /* Hide scan button on chat page */
    body.chat-page .scan-button-float {
        display: none !important;
    }
</style>
{% endblock %}

{% block content %}
<script>
    // Add class to body to identify chat page
    document.body.classList.add('chat-page');
</script>
<!-- Chat Messages Container -->
<div class="max-w-5xl mx-auto px-2 sm:px-4">
    <div class="glass-card p-4 sm:p-6 mb-32 lg:mb-16">
        <div class="chat-container" id="chatContainer">
            <div id="messages" class="space-y-6 sm:space-y-8">
                {% for message in messages %}
                {% if message.role == 'user' %}
                <!-- User Message -->
                <div class="flex justify-end">
                    <div
                        class="message-bubble bg-gradient-to-br from-purple-500 to-pink-600 text-white p-4 rounded-2xl rounded-tr-sm shadow-lg">
                        {{ message.content | safe }}
                    </div>
                </div>
                {% else %}
                <!-- AI Message -->
                <div class="flex justify-start group">
                    <div class="message-bubble glass p-4 rounded-2xl rounded-tl-sm text-white shadow-lg relative">
                        {{ message.content | safe }}
                        <button onclick="speakMessage(this.parentElement.innerText)"
                            class="absolute -right-8 top-2 text-white/70 hover:text-white opacity-0 group-hover:opacity-100 transition-opacity p-1.5 bg-white/20 rounded-full backdrop-blur-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Chat Input (Fixed at Bottom) -->
<div
    class="chat-input-container fixed bottom-20 sm:bottom-24 left-0 right-0 px-4 sm:px-6 md:bottom-4 transition-all duration-300 z-50">
    <div class="max-w-4xl mx-auto">
        <form hx-post="/api/chat" hx-target="#messages" hx-swap="beforeend" hx-headers='{"X-Client-Appended":"true"}'
            hx-on::after-request="this.reset(); scrollToBottom();"
            class="glass-card p-3 sm:p-4 flex items-center gap-3 sm:gap-4" id="chat-form">
            <input type="text" name="message" placeholder="AI CFO-dan nə öyrənmək istəyirsən?" required
                class="chat-input-field flex-1" autocomplete="off" id="chat-input" />
            <button type="submit"
                class="w-10 h-10 sm:w-12 sm:h-12 flex-shrink-0 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center hover:scale-110 transition shadow-lg group">
                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white group-hover:scale-110 transition" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/chat.js"></script>
{% endblock %}