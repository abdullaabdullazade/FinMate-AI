{% extends "base.html" %}

{% block title %}HÉ™diyyÉ™lÉ™r - FinMate AI{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-6 pb-24 lg:ml-64" style="overflow: visible !important;">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-white mb-2">ğŸ MÃ¼kafat MaÄŸazasÄ±</h1>
        <p class="text-white/60 text-sm">Coin toplayÄ±n, hÉ™diyyÉ™lÉ™r qazanÄ±n!</p>
    </div>

    <!-- Current Balance Card - REDESIGNED -->
    <div class="glass-card p-6 mb-8 bg-gradient-to-br from-yellow-500/10 to-amber-500/10 border border-yellow-500/20 rounded-2xl"
        style="box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);">
        <div class="flex items-center justify-between">
            <div class="flex-1 pl-4">
                <p class="text-white/60 text-sm mb-2">BalansÄ±nÄ±z</p>
                <div class="flex items-center gap-4">
                    <span class="text-4xl">ğŸª™</span>
                    <span id="coin-balance" class="text-5xl font-bold text-yellow-400">{{ user.coins if user.coins is
                        defined else 0 }}</span>
                </div>
            </div>
        </div>
        <div class="mt-4 pt-4 border-t border-white/10 pl-4">
            <p class="text-white/50 text-xs">ğŸ’¡ HÉ™r qÉ™bz scan = +1 coin</p>
        </div>
    </div>

    <!-- Available Rewards - REDESIGNED CAROUSEL -->
    <div class="mb-8" style="overflow: visible;">
        <h2 class="text-xl font-bold text-white mb-6 px-1">ğŸ›’ HÉ™diyyÉ™ SeÃ§imlÉ™ri</h2>

        <!-- Carousel Container -->
        <div class="relative" style="overflow: visible; padding: 1rem 0.5rem;">
            <!-- Scroll Buttons - Fixed Position to Avoid Overlap -->
            <button onclick="scrollRewards('left')"
                class="absolute left-2 md:left-4 top-1/2 -translate-y-1/2 z-20 bg-white/15 hover:bg-white/25 backdrop-blur-md p-2.5 md:p-3 rounded-full transition-all duration-200 shadow-lg border border-white/20 hidden md:flex items-center justify-center">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <button onclick="scrollRewards('right')"
                class="absolute right-2 md:right-4 top-1/2 -translate-y-1/2 z-20 bg-white/15 hover:bg-white/25 backdrop-blur-md p-2.5 md:p-3 rounded-full transition-all duration-200 shadow-lg border border-white/20 hidden md:flex items-center justify-center">
                <svg class="w-5 h-5 md:w-6 md:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
                </svg>
            </button>

            <!-- Scrollable Rewards - Added padding to prevent arrow overlap -->
            <div id="rewards-carousel" class="flex gap-6 overflow-x-auto scrollbar-hide snap-x snap-mandatory pb-6 px-4 md:px-12"
                style="scroll-behavior: smooth; overflow-y: visible !important;">
                {% set current_coins = user.coins if user.coins is defined else 0 %}

                <!-- 100 Coins - Bronze - REDESIGNED -->
                <div class="flex-shrink-0 w-72 sm:w-80 snap-center reward-card-wrapper">
                    <div class="glass-card p-5 sm:p-6 h-full border border-amber-400/30 hover:border-amber-400/60 transition-all duration-300 bg-gradient-to-br from-amber-500/5 to-yellow-500/5 rounded-2xl relative reward-card-hover"
                        style="box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(251, 191, 36, 0.1);">
                        <!-- Badge Container - Fixed Alignment -->
                        <div class="flex justify-between items-center mb-5 min-h-[28px]">
                            <span
                                class="px-3 py-1.5 rounded-lg bg-amber-500/20 text-amber-200 text-[11px] font-bold uppercase tracking-wider border border-amber-400/30 flex-shrink-0">Bronz</span>
                            {% if reward_counts.get('bronze', 0) > 0 %}
                            <span class="px-2.5 py-1 rounded-lg bg-green-500/25 text-green-200 text-[11px] font-semibold border border-green-400/30 flex items-center gap-1 flex-shrink-0">
                                <span>âœ“</span>
                                <span>{{ reward_counts.get('bronze') }}x</span>
                            </span>
                            {% else %}
                            <span class="flex-shrink-0"></span>
                            {% endif %}
                        </div>
                        <!-- Content Section - Improved Spacing -->
                        <div class="text-center mb-6">
                            <div class="text-6xl sm:text-7xl mb-5 flex justify-center items-center leading-none">ğŸ¥‰</div>
                            <h3 class="text-xl sm:text-2xl font-bold text-white mb-3 tracking-tight leading-tight">Coffee Kuponu</h3>
                            <div class="h-0.5 bg-gradient-to-r from-transparent via-amber-400/40 to-transparent mb-4 mx-auto max-w-[120px]">
                            </div>
                            <p class="text-white/60 text-sm font-medium">1 É™dÉ™d pulsuz kofe</p>
                        </div>
                        <!-- Coin Display - Better Alignment -->
                        <div class="bg-black/25 rounded-2xl p-4 mb-6 border border-amber-400/25 backdrop-blur-sm">
                            <div class="flex items-center justify-center gap-2.5">
                                <span class="text-yellow-400 text-xl sm:text-2xl leading-none">ğŸª™</span>
                                <span class="text-yellow-400 font-bold text-2xl sm:text-3xl leading-none tracking-tight">100</span>
                                <span class="text-white/40 text-xs sm:text-sm font-medium ml-0.5">coin</span>
                            </div>
                        </div>
                        <!-- Button - Fixed Text Alignment -->
                        <button onclick="openClaimModal('bronze', 100, 'ğŸ¥‰', 'Coffee Kuponu')"
                            class="w-full px-5 py-3.5 rounded-xl font-bold text-base sm:text-lg transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 {% if current_coins >= 100 %}bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 text-black shadow-lg shadow-amber-500/50{% else %}bg-white/5 text-white/30 cursor-not-allowed border border-white/10{% endif %}"
                            {% if current_coins < 100 %}disabled{% endif %}>
                            {% if current_coins >= 100 %}
                            <span>ğŸ›’</span>
                            <span>Al Ä°ndi</span>
                            {% else %}
                            <span>ğŸ”’</span>
                            <span>KiliddÉ™</span>
                            {% endif %}
                        </button>
                    </div>
                </div>

                <!-- 200 Coins - Silver - REDESIGNED -->
                <div class="flex-shrink-0 w-72 sm:w-80 snap-center reward-card-wrapper">
                    <div class="glass-card p-6 h-full border border-gray-300/30 hover:border-gray-300/60 transition-all duration-300 bg-gradient-to-br from-gray-300/5 to-gray-400/5 rounded-2xl reward-card-hover"
                        style="box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);">
                        <div class="flex justify-between items-start mb-4">
                            <span
                                class="px-2.5 py-1 rounded-lg bg-gray-300/15 text-gray-200 text-[10px] font-bold uppercase tracking-wide">GÃ¼mÃ¼ÅŸ</span>
                            {% if reward_counts.get('silver', 0) > 0 %}
                            <span class="px-2 py-1 rounded-lg bg-green-500/20 text-green-300 text-xs">âœ“ {{
                                reward_counts.get('silver') }}x</span>
                            {% endif %}
                        </div>
                        <div class="text-center mb-5">
                            <div class="text-7xl mb-4 flex justify-center items-center">ğŸ¥ˆ</div>
                            <h3 class="text-2xl font-semibold text-white mb-2 tracking-tight">Coffee Paket</h3>
                            <div class="h-px bg-gradient-to-r from-transparent via-gray-300/30 to-transparent mb-3">
                            </div>
                            <p class="text-white/70 text-sm">3 É™dÉ™d pulsuz kofe</p>
                        </div>
                        <div class="bg-black/30 rounded-xl p-4 mb-5 border border-gray-300/20">
                            <div class="flex items-center justify-center gap-3">
                                <span class="text-yellow-400 text-2xl">ğŸª™</span>
                                <span class="text-yellow-400 font-bold text-3xl">200</span>
                                <span class="text-white/50 text-sm">coin</span>
                            </div>
                        </div>
                        <button onclick="openClaimModal('silver', 200, 'ğŸ¥ˆ', 'Coffee Paket')"
                            class="w-full px-5 py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] {% if current_coins >= 200 %}bg-gradient-to-r from-gray-200 to-gray-300 hover:from-gray-300 hover:to-gray-400 text-black shadow-lg shadow-gray-300/40{% else %}bg-white/5 text-white/30 cursor-not-allowed border border-white/10{% endif %}"
                            {% if current_coins < 200 %}disabled{% endif %}>
                            {% if current_coins >= 200 %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ›’</span><span>Al
                                    Ä°ndi</span></span>{% else %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ”’</span><span>KiliddÉ™</span></span>{%
                            endif %}
                        </button>
                    </div>
                </div>

                <!-- 500 Coins - Gold - REDESIGNED -->
                <div class="flex-shrink-0 w-72 sm:w-80 snap-center reward-card-wrapper">
                    <div class="glass-card p-6 h-full border border-yellow-400/30 hover:border-yellow-400/60 transition-all duration-300 bg-gradient-to-br from-yellow-400/5 to-amber-500/5 rounded-2xl reward-card-hover"
                        style="box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);">
                        <div class="flex justify-between items-start mb-4">
                            <span
                                class="px-2.5 py-1 rounded-lg bg-yellow-400/15 text-yellow-200 text-[10px] font-bold uppercase tracking-wide">QÄ±zÄ±l</span>
                            {% if reward_counts.get('gold', 0) > 0 %}
                            <span class="px-2 py-1 rounded-lg bg-green-500/20 text-green-300 text-xs">âœ“ {{
                                reward_counts.get('gold') }}x</span>
                            {% endif %}
                        </div>
                        <div class="text-center mb-5">
                            <div class="text-7xl mb-4 flex justify-center items-center">ğŸ¥‡</div>
                            <h3 class="text-2xl font-semibold text-white mb-2 tracking-tight">Pul MÃ¼kafatÄ±</h3>
                            <div class="h-px bg-gradient-to-r from-transparent via-yellow-400/30 to-transparent mb-3">
                            </div>
                            <p class="text-white/70 text-sm">5 AZN bank hesabÄ±nÄ±za</p>
                        </div>
                        <div class="bg-black/30 rounded-xl p-4 mb-5 border border-yellow-400/20">
                            <div class="flex items-center justify-center gap-3">
                                <span class="text-yellow-400 text-2xl">ğŸª™</span>
                                <span class="text-yellow-400 font-bold text-3xl">500</span>
                                <span class="text-white/50 text-sm">coin</span>
                            </div>
                        </div>
                        <button onclick="openClaimModal('gold', 500, 'ğŸ¥‡', 'Pul MÃ¼kafatÄ± - 5 AZN')"
                            class="w-full px-5 py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] {% if current_coins >= 500 %}bg-gradient-to-r from-yellow-400 to-amber-500 hover:from-yellow-500 hover:to-amber-600 text-black shadow-lg shadow-yellow-400/40{% else %}bg-white/5 text-white/30 cursor-not-allowed border border-white/10{% endif %}"
                            {% if current_coins < 500 %}disabled{% endif %}>
                            {% if current_coins >= 500 %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ›’</span><span>Al
                                    Ä°ndi</span></span>{% else %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ”’</span><span>KiliddÉ™</span></span>{%
                            endif %}
                        </button>
                    </div>
                </div>

                <!-- 5000 Coins - Platinum - REDESIGNED -->
                <div class="flex-shrink-0 w-72 sm:w-80 snap-center reward-card-wrapper">
                    <div class="glass-card p-6 h-full border border-purple-500/30 hover:border-purple-500/60 transition-all duration-300 bg-gradient-to-br from-purple-500/5 to-pink-500/5 rounded-2xl reward-card-hover"
                        style="box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);">
                        <div class="flex justify-between items-start mb-4">
                            <span
                                class="px-2.5 py-1 rounded-lg bg-purple-500/15 text-purple-200 text-[10px] font-bold uppercase tracking-wide">Platin</span>
                            {% if reward_counts.get('platinum', 0) > 0 %}
                            <span class="px-2 py-1 rounded-lg bg-green-500/20 text-green-300 text-xs">âœ“ {{
                                reward_counts.get('platinum') }}x</span>
                            {% endif %}
                        </div>
                        <div class="text-center mb-5">
                            <div class="text-7xl mb-4 flex justify-center items-center">ğŸ’</div>
                            <h3 class="text-2xl font-semibold text-white mb-2 tracking-tight">Premium Paket</h3>
                            <div class="h-px bg-gradient-to-r from-transparent via-purple-400/30 to-transparent mb-3">
                            </div>
                            <p class="text-white/70 text-sm">1 ay Premium + 20 AZN</p>
                        </div>
                        <div class="bg-black/30 rounded-xl p-4 mb-5 border border-purple-400/20">
                            <div class="flex items-center justify-center gap-3">
                                <span class="text-yellow-400 text-2xl">ğŸª™</span>
                                <span class="text-yellow-400 font-bold text-3xl">5000</span>
                                <span class="text-white/50 text-sm">coin</span>
                            </div>
                        </div>
                        <button onclick="openClaimModal('platinum', 5000, 'ğŸ’', 'Premium Paket')"
                            class="w-full px-5 py-4 rounded-xl font-bold text-lg transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] {% if current_coins >= 5000 %}bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white shadow-lg shadow-purple-500/40{% else %}bg-white/5 text-white/30 cursor-not-allowed border border-white/10{% endif %}"
                            {% if current_coins < 5000 %}disabled{% endif %}>
                            {% if current_coins >= 5000 %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ›’</span><span>Al
                                    Ä°ndi</span></span>{% else %}<span
                                class="flex items-center justify-center gap-2.5"><span>ğŸ”’</span><span>KiliddÉ™</span></span>{%
                            endif %}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scroll Indicator Dots -->
            <div class="flex justify-center gap-2 mt-6">
                <div class="w-2 h-2 rounded-full bg-amber-400"></div>
                <div class="w-2 h-2 rounded-full bg-gray-300"></div>
                <div class="w-2 h-2 rounded-full bg-yellow-400"></div>
                <div class="w-2 h-2 rounded-full bg-purple-400"></div>
            </div>
        </div>
    </div>

    <!-- Claimed Rewards History - REDESIGNED -->
    <div class="space-y-4">
        <h2 class="text-xl font-bold text-white mb-6 px-1">ğŸ“œ AlÄ±nmÄ±ÅŸ HÉ™diyyÉ™lÉ™r</h2>
        {% if claimed_rewards %}
        <div class="space-y-3">
            {% for reward in claimed_rewards %}
            <div class="glass-card p-5 flex items-center justify-between hover:bg-white/5 transition rounded-xl"
                style="box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">
                <div class="flex items-center gap-4">
                    <span class="text-3xl">
                        {% if reward.reward_type == 'bronze' %}ğŸ¥‰
                        {% elif reward.reward_type == 'silver' %}ğŸ¥ˆ
                        {% elif reward.reward_type == 'gold' %}ğŸ¥‡
                        {% else %}ğŸ’{% endif %}
                    </span>
                    <div>
                        <p class="text-white font-semibold text-base">{{ reward.reward_name }}</p>
                        <p class="text-white/50 text-xs mt-0.5">{{ reward.claimed_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    </div>
                </div>
                <span class="text-red-400 font-bold text-base">-{{ reward.coins_spent }} ğŸª™</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="glass-card p-8 text-center rounded-xl" style="box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);">
            <p class="text-white/50 text-base">HÉ™lÉ™ hÉ™diyyÉ™ almamÄ±sÄ±nÄ±z</p>
            <p class="text-white/30 text-sm mt-1">Coin toplayÄ±n vÉ™ yuxarÄ±dan seÃ§in!</p>
        </div>
        {% endif %}
    </div>

    <!-- Claim Confirmation Modal - REDESIGNED -->
    <div id="claim-modal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="glass-card max-w-md w-full p-8 mx-4 animate-scale-in rounded-2xl"
            style="box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);">
            <div class="text-center mb-8">
                <div id="modal-icon" class="text-7xl mb-5">ğŸ</div>
                <h3 id="modal-title" class="text-2xl font-bold text-white mb-3">HÉ™diyyÉ™ Al</h3>
                <p id="modal-description" class="text-white/70 text-sm"></p>
            </div>

            <div class="bg-white/5 rounded-xl p-5 mb-8 border border-white/10">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-white/70 text-sm">Cari Balans:</span>
                    <span id="modal-current-coins" class="text-yellow-400 font-bold text-lg"></span>
                </div>
                <div class="flex items-center justify-between mb-3">
                    <span class="text-white/70 text-sm">QiymÉ™t:</span>
                    <span id="modal-cost" class="text-red-400 font-bold text-lg"></span>
                </div>
                <div class="border-t border-white/10 my-3"></div>
                <div class="flex items-center justify-between">
                    <span class="text-white font-medium text-base">Qalacaq:</span>
                    <span id="modal-remaining" class="text-green-400 font-bold text-xl"></span>
                </div>
            </div>

            <div class="flex gap-3">
                <button onclick="closeClaimModal()"
                    class="flex-1 px-5 py-4 rounded-xl bg-white/10 hover:bg-white/20 text-white font-semibold transition-all active:scale-95">
                    âŒ Ä°mtina
                </button>
                <button id="confirm-claim-btn" onclick="confirmClaim()"
                    class="flex-1 px-5 py-4 rounded-xl bg-green-500 hover:bg-green-600 text-white font-bold transition-all active:scale-95">
                    âœ… TÉ™sdiq Et
                </button>
            </div>
        </div>
    </div>

    <!-- Coffee Coupon Modal -->
    <div id="coupon-modal"
        class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md transition-opacity duration-300 opacity-0">
        <div class="glass-card max-w-sm w-full p-0 mx-4 transform scale-90 transition-transform duration-300 rounded-3xl overflow-hidden relative"
            id="coupon-content" style="box-shadow: 0 0 50px rgba(196, 139, 96, 0.3);">
            <!-- Confetti Canvas -->
            <canvas id="coupon-confetti" class="absolute inset-0 w-full h-full pointer-events-none z-10"></canvas>

            <div class="bg-gradient-to-br from-[#C48B60] to-[#A06B45] p-6 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-10"
                    style="background-image: url('data:image/svg+xml,%3Csvg width=\'20\' height=\'20\' viewBox=\'0 0 20 20\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\' fill-rule=\'evenodd\'%3E%3Ccircle cx=\'3\' cy=\'3\' r=\'3\'/%3E%3Ccircle cx=\'13\' cy=\'13\' r=\'3\'/%3E%3C/g%3E%3C/svg%3E');">
                </div>

                <div
                    class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl border border-white/30">
                    <span class="text-5xl">â˜•</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-1">Coffee Kuponu</h3>
                <p class="text-white/80 text-sm font-medium">TÉ™briklÉ™r! DadÄ±nÄ± Ã§Ä±xarÄ±n.</p>
            </div>

            <div class="p-6 bg-[#1a1a1a] relative">
                <!-- Ticket Cutout Effect -->
                <div class="absolute -top-3 left-0 w-6 h-6 bg-[#1a1a1a] rounded-full -ml-3"></div>
                <div class="absolute -top-3 right-0 w-6 h-6 bg-[#1a1a1a] rounded-full -mr-3"></div>
                <div class="border-t-2 border-dashed border-white/10 absolute top-0 left-4 right-4"></div>

                <div class="text-center space-y-4 pt-2">
                    <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                        <p class="text-white/40 text-xs uppercase tracking-widest mb-1">KOD</p>
                        <p class="text-2xl font-mono font-bold text-white tracking-wider" id="coupon-code">FREE-COFFEE
                        </p>
                    </div>

                    <p class="text-white/50 text-xs">Bu kuponu kassaya tÉ™qdim edin.</p>

                    <button onclick="closeCouponModal()"
                        class="w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition transform hover:scale-[1.02]">
                        BaÄŸla
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    @keyframes scale-in {
        from {
            transform: scale(0.9);
            opacity: 0;
        }

        to {
            transform: scale(1);
            opacity: 1;
        }
    }

    .animate-scale-in {
        animation: scale-in 0.2s ease-out;
    }

    /* Fix overflow issue on hover for reward cards - COMPLETE FIX */
    #rewards-carousel {
        overflow-y: visible !important;
        overflow-x: auto;
        padding: 12px 0 !important;
    }

    /* Card wrapper with padding to prevent overflow */
    .reward-card-wrapper {
        padding: 12px !important;
        margin: -12px !important;
        overflow: visible !important;
    }

    #rewards-carousel > div {
        overflow: visible !important;
    }

    #rewards-carousel > div > .glass-card {
        will-change: transform, box-shadow;
        transform-origin: center;
        overflow: visible !important;
    }

    /* Ensure ALL parent containers allow overflow */
    .max-w-2xl.mx-auto {
        overflow: visible !important;
    }

    /* Fix parent container in base.html */
    .w-full.lg\\:max-w-7xl.mx-auto {
        overflow: visible !important;
    }

    /* Fix main content wrapper */
    .pt-24.pb-8.px-4 {
        overflow: visible !important;
    }

    /* Force overflow visible on all possible parents */
    body > div,
    [class*="max-w"],
    [class*="container"] {
        overflow-x: visible !important;
    }

    /* Reward Card Improvements */
    .reward-card-badge {
        line-height: 1.2;
        letter-spacing: 0.05em;
    }

    .reward-card-emoji {
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    .reward-card-title {
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .reward-coin-display {
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* NO SCALE - Only translateY to prevent overflow */
    .reward-card-hover {
        transform-origin: center;
        will-change: transform, box-shadow;
    }

    /* Desktop hover - NO SCALE, only translateY */
    @media (min-width: 640px) {
        .reward-card-hover:hover {
            transform: translateY(-6px) !important;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.25), 0 6px 16px rgba(251, 191, 36, 0.2) !important;
            z-index: 15 !important;
            position: relative;
        }
    }

    /* Mobile hover - NO SCALE */
    @media (max-width: 639px) {
        .reward-card-hover:hover {
            transform: translateY(-4px) !important;
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.2), 0 4px 12px rgba(251, 191, 36, 0.15) !important;
            z-index: 15 !important;
            position: relative;
        }
    }
</style>

<script>
    let currentRewardType = '';
    let currentCost = 0;

    function scrollRewards(direction) {
        const carousel = document.getElementById('rewards-carousel');
        const cardWidth = 288 + 12;
        if (direction === 'left') {
            carousel.scrollLeft -= cardWidth;
        } else {
            carousel.scrollLeft += cardWidth;
        }
    }

    function openClaimModal(rewardType, cost, icon, name) {
        const currentCoins = parseInt(document.getElementById('coin-balance').textContent);
        if (currentCoins < cost) {
            window.showToast(`KifayÉ™t qÉ™dÉ™r coin yoxdur. LazÄ±m: ${cost}, Sizin: ${currentCoins}`, 'error');
            return;
        }
        currentRewardType = rewardType;
        currentCost = cost;
        document.getElementById('modal-icon').textContent = icon;
        document.getElementById('modal-title').textContent = name;
        document.getElementById('modal-description').textContent = `Bu hÉ™diyyÉ™ni almaq istÉ™yirsiniz?`;
        document.getElementById('modal-current-coins').textContent = `ğŸª™ ${currentCoins}`;
        document.getElementById('modal-cost').textContent = `-ğŸª™ ${cost}`;
        document.getElementById('modal-remaining').textContent = `ğŸª™ ${currentCoins - cost}`;
        document.getElementById('claim-modal').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        // Voice notification will be handled automatically by event-manager.js
    }

    function closeClaimModal() {
        document.getElementById('claim-modal').classList.add('hidden');
        document.body.style.overflow = '';
        currentRewardType = '';
        currentCost = 0;
    }

    function confirmClaim() {
        if (!currentRewardType || !currentCost) return;
        const btn = document.getElementById('confirm-claim-btn');
        btn.disabled = true;
        btn.textContent = 'â³ GÃ¶zlÉ™yin...';
        fetch('/api/claim-reward', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `reward_type=${currentRewardType}`
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal first
                    closeClaimModal();

                    // Update coin balance without refresh
                    const coinBalance = document.getElementById('coin-balance');
                    if (coinBalance && data.new_balance !== undefined) {
                        coinBalance.textContent = data.new_balance;
                    }

                    // Show success message with voice
                    const rewardName = document.getElementById('modal-title')?.textContent || 'HÉ™diyyÉ™';
                    const successMessage = `${rewardName} uÄŸurla alÄ±ndÄ±!`;
                    window.showToast(successMessage, 'success');

                    // Voice notification - say that reward was claimed
                    if (typeof window.queueVoiceNotification === 'function') {
                        const cleanRewardName = rewardName.replace(/[ğŸ¥‰ğŸ¥ˆğŸ¥‡ğŸ’ğŸ]/g, '').trim();
                        const voiceMessage = `${cleanRewardName} uÄŸurla alÄ±ndÄ±. TÉ™briklÉ™r!`;
                        window.queueVoiceNotification(voiceMessage, 0, 'az');
                    }

                    // Show coupon if applicable
                    if (data.show_coupon) {
                        setTimeout(() => {
                            showCouponModal();
                        }, 500);
                    } else {
                        // If no coupon, reload page immediately to show updated data
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }

                    // Update rewards list if needed (without refresh)
                    if (typeof htmx !== 'undefined') {
                        // Trigger event to update rewards
                        document.body.dispatchEvent(new Event('rewardClaimed'));
                    }
                } else {
                    window.showToast(data.error || 'XÉ™ta baÅŸ verdi', 'error');
                    btn.disabled = false;
                    btn.textContent = 'âœ… TÉ™sdiq Et';
                }
            })
            .catch(error => {
                window.showToast('XÉ™ta baÅŸ verdi', 'error');
                console.error('Error:', error);
                btn.disabled = false;
                btn.textContent = 'âœ… TÉ™sdiq Et';
            });
    }

    document.getElementById('claim-modal')?.addEventListener('click', function (e) {
        if (e.target === this) closeClaimModal();
    });

    // Coupon Modal Functions
    function showCouponModal() {
        const modal = document.getElementById('coupon-modal');
        const content = document.getElementById('coupon-content');
        modal.classList.remove('hidden');
        // Trigger reflow
        void modal.offsetWidth;
        modal.classList.remove('opacity-0');
        content.classList.remove('scale-90');
        content.classList.add('scale-100');

        // Launch confetti inside modal
        const canvas = document.getElementById('coupon-confetti');
        const myConfetti = confetti.create(canvas, {
            resize: true,
            useWorker: true
        });
        myConfetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#C48B60', '#ffffff', '#FFD700']
        });
    }

    function closeCouponModal() {
        const modal = document.getElementById('coupon-modal');
        const content = document.getElementById('coupon-content');
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-90');
        setTimeout(() => {
            modal.classList.add('hidden');
            // Reload page to show updated coin balance and claimed rewards
            window.location.reload();
        }, 300);
    }
</script>
{% endblock %}