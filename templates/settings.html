{% extends "base.html" %}

{% block title %}Settings - FinMate AI{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-2 sm:px-4 py-4 sm:py-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 sm:mb-10 slide-up gap-3">
        <div class="flex-1 min-w-0">
            <h1
                class="text-2xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-white to-white/70">
                T…ônziml…ôm…ôl…ôr
            </h1>
            <p class="text-white/60 mt-1 sm:mt-2 text-sm sm:text-lg">≈û…ôxsi se√ßiml…ôrinizi v…ô b√ºdc…ônizi idar…ô edin</p>
        </div>
        <a href="/"
            class="group flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-white transition-all hover:scale-105 text-sm sm:text-base">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 group-hover:-translate-x-1 transition-transform" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18">
                </path>
            </svg>
            <span>Geri</span>
        </a>
    </div>

    <!-- Settings Form -->
    <form id="settings-form" hx-post="/api/settings" hx-swap="none" hx-trigger="submit" class="space-y-8">

        <!-- Budget Section -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.1s; will-change: transform;">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-green-400 to-emerald-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-green-500/30 flex-shrink-0">
                    üí∞
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">B√ºdc…ô ƒ∞dar…ôetm…ôsi</h2>
                    <p class="text-white/50 text-xs sm:text-sm">Aylƒ±q v…ô g√ºnd…ôlik limitl…ôrinizi t…ôyin edin</p>
                </div>
            </div>

            <div class="space-y-8">
                <!-- Monthly Budget Input -->
                <div>
                    <div class="flex justify-between items-end mb-3 sm:mb-4">
                        <label class="text-xs sm:text-sm font-medium text-white/80">Aylƒ±q B√ºdc…ô</label>
                        <div class="text-right flex items-center gap-2">
                            <input type="number" id="monthly-budget-input" name="monthly_budget"
                                value="{{ user.monthly_budget }}" step="0.01" min="100"
                                class="w-24 sm:w-32 bg-black/20 text-green-400 text-xl sm:text-2xl font-bold text-right px-2 py-1 rounded-lg border border-white/10 focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none transition-all"
                                oninput="updateBudgetDisplay(this.value)" onblur="validateBudgetInput(this)"
                                placeholder="100" required>
                            <span id="budget-display-unit"
                                class="text-white/60 text-xs sm:text-sm font-medium">AZN</span>
                        </div>
                    </div>
                    <div class="relative h-2 bg-white/10 rounded-full">
                        {% set slider_max = max(100000, user.monthly_budget) %}
                        <input type="range" id="monthly-budget-slider" name="monthly_budget_slider" min="100"
                            max="{{ slider_max }}" step="50" value="{{ user.monthly_budget }}"
                            class="absolute w-full h-full opacity-0 cursor-pointer z-10"
                            oninput="updateBudgetFromSlider(this.value)">
                        <div id="budget-progress"
                            class="absolute top-0 left-0 h-full bg-gradient-to-r from-green-400 to-emerald-500 rounded-full transition-all duration-150"
                            style="width: {{ (user.monthly_budget / slider_max * 100)|int }}%">
                        </div>
                        <div id="budget-thumb"
                            class="absolute top-1/2 -mt-3 w-6 h-6 bg-white rounded-full shadow-lg shadow-black/50 transition-all duration-150 pointer-events-none"
                            style="left: {{ (user.monthly_budget / slider_max * 100)|int }}%; transform: translateX(-50%) translateY(-50%);">
                        </div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-white/40 font-medium">
                        <span id="budget-min-label">100 <span id="currency-symbol-min">AZN</span></span>
                        <span id="budget-max-label">{{ "%.0f"|format(slider_max) }}</span>
                    </div>
                </div>

                <!-- Daily Limit Input -->
                <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:border-white/20 transition-colors">
                    <label class="block text-sm font-medium text-white/80 mb-2">
                        G√ºnd…ôlik X…ôrc Limiti (Opsional)
                    </label>
                    <div class="relative">
                        <span id="daily-currency-symbol"
                            class="absolute right-4 top-1/2 -translate-y-1/2 text-white/40">AZN</span>
                        <input type="number" name="daily_budget_limit" id="daily-budget-limit-input"
                            value="{{ '%.2f'|format(user.daily_budget_limit) if user.daily_budget_limit else '' }}"
                            placeholder="Limit yoxdur" min="0" step="0.01"
                            class="w-full bg-black/20 text-white pl-4 pr-10 py-3 rounded-lg border border-white/10 focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none transition-all placeholder-white/20"
                            oninput="validateDailyLimit(this)" onblur="formatDailyLimit(this)">
                    </div>
                    <p class="text-xs text-white/40 mt-2 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Limit ke√ßildikd…ô x…ôb…ôrdarlƒ±q alacaqsƒ±nƒ±z (<span id="daily-limit-range">ƒ∞st…ônil…ôn m…ôbl…ôƒü <span
                                id="daily-limit-currency">AZN</span></span>
                        arasƒ±)
                    </p>
                </div>
            </div>
        </div>

        <!-- Preferences Section -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.2s">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-purple-400 to-indigo-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-indigo-500/30 flex-shrink-0">
                    ‚öôÔ∏è
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">T…ôrcihl…ôr</h2>
                    <p class="text-white/50 text-xs sm:text-sm">T…ôtbiqi √∂z√ºn√ºz…ô uyƒüunla≈üdƒ±rƒ±n</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Voice Commands Toggle -->
                <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:border-white/20 transition-colors">
                    <div class="flex items-center justify-between gap-3">
                        <div class="flex-1 min-w-0">
                            <label class="block text-sm font-medium text-white mb-1">S…ôsli ∆èmrl…ôr</label>
                            <p class="text-xs text-white/50">Mikrofon il…ô x…ôrc …ôlav…ô et</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="hidden" name="voice_enabled" value="false">
                            <input type="checkbox" name="voice_enabled" value="true" {% if user.voice_enabled
                                %}checked{% endif %} class="sr-only peer">
                            <div
                                class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-500 transition-colors">
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Voice Mode Toggle (TTS) -->
                <div
                    class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between hover:border-white/20 transition-colors">
                    <div>
                        <label class="block text-sm font-medium text-white">üîä S…ôsl…ôndirm…ô</label>
                        <p class="text-xs text-white/50 mt-1">M…ôtnl…ôri s…ôsli oxumaq</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="voice-mode-toggle" class="sr-only peer"
                            onchange="toggleVoiceMode(this.checked)">
                        <div
                            class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-500 transition-colors">
                        </div>
                    </label>
                </div>

                <!-- Readability Mode Toggle (NEW) -->
                <div
                    class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between hover:border-white/20 transition-colors md:col-span-2">
                    <div>
                        <label class="block text-sm font-medium text-white">üëÅÔ∏è Oxunaqlƒ±lƒ±q Rejimi</label>
                        <p class="text-xs text-white/50 mt-1">G√∂z√º z…ôif g√∂r…ônl…ôr √º√ß√ºn b√∂y√ºk yazƒ±</p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="hidden" name="readability_mode" value="false">
                        <input type="checkbox" id="readability-mode-toggle" name="readability_mode" value="true" {% if
                            user.readability_mode %}checked{% endif %} class="sr-only peer"
                            onchange="toggleReadabilityMode(this.checked)">
                        <div
                            class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500 transition-colors">
                        </div>
                    </label>
                </div>
            </div>
        </div>


        <!-- AI Persona Customization Section -->
        <div class="glass-card p-8 slide-up" style="animation-delay: 0.25s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-pink-400 to-rose-600 flex items-center justify-center text-2xl shadow-lg shadow-pink-500/30">
                    ü§ñ
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">AI Xarakteri</h2>
                    <p class="text-white/50 text-sm">Maliyy…ô k√∂m…ôk√ßinizi √∂z√ºn√ºz…ô uyƒüunla≈üdƒ±rƒ±n</p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- AI Persona Mode -->
                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">Persona Rejimi</label>
                    <div class="relative">
                        <select name="ai_persona_mode"
                            class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                            <option value="Auto" class="bg-gray-900" {% if user.ai_persona_mode=='Auto' %}selected{%
                                endif %}>üé≠
                                Avtomatik (M…ôsl…ôh…ôtli)</option>
                            <option value="Manual" class="bg-gray-900" {% if user.ai_persona_mode=='Manual' %}selected{%
                                endif %}>‚úçÔ∏è ∆èl il…ô (Manual)</option>
                        </select>
                        <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-xs text-white/40 mt-2">
                        <svg class="w-3 h-3 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Avtomatik rejim b√ºdc…ôniz…ô …ôsas…ôn AI xarakterini d…ôyi≈üir
                    </p>
                </div>

                <!-- AI Name -->
                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">AI Adƒ±</label>
                    <input type="text" name="ai_name" value="{{ user.ai_name or 'FinMate' }}" placeholder="FinMate"
                        class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none transition-all placeholder-white/20">
                </div>

                <!-- Manual Mode Settings (only shown if Manual selected) -->
                <div id="manual-mode-fields" class="grid grid-cols-1 md:grid-cols-2 gap-6"
                    style="display: {% if user.ai_persona_mode == 'Manual' %}grid{% else %}none{% endif %};">
                    <!-- AI Attitude -->
                    <div>
                        <label class="block text-sm font-medium text-white/80 mb-2">M√ºnasib…ôt</label>
                        <div class="relative">
                            <select name="ai_attitude"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="Professional" class="bg-gray-900" {% if user.ai_attitude=='Professional'
                                    %}selected{% endif %}>üíº Professional</option>
                                <option value="Strict" class="bg-gray-900" {% if user.ai_attitude=='Strict' %}selected{%
                                    endif %}>üò§ S…ôrt Ana</option>
                                <option value="Funny" class="bg-gray-900" {% if user.ai_attitude=='Funny' %}selected{%
                                    endif %}>
                                    üòÑ Zarafatcƒ±l</option>
                                <option value="Sarcastic" class="bg-gray-900" {% if user.ai_attitude=='Sarcastic'
                                    %}selected{% endif %}>üòè Sarkastik</option>
                                <option value="Supportive" class="bg-gray-900" {% if user.ai_attitude=='Supportive'
                                    %}selected{% endif %}>ü§ó D…ôst…ôkl…ôyici</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- AI Style -->
                    <div>
                        <label class="block text-sm font-medium text-white/80 mb-2">Danƒ±≈üƒ±q T…ôrzi</label>
                        <div class="relative">
                            <select name="ai_style"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="Formal" class="bg-gray-900" {% if user.ai_style=='Formal' %}selected{%
                                    endif %}>
                                    üé© R…ôsmi</option>
                                <option value="Slang" class="bg-gray-900" {% if user.ai_style=='Slang' %}selected{%
                                    endif %}>üòé
                                    Jarqon / Slang</option>
                                <option value="Shakespearean" class="bg-gray-900" {% if user.ai_style=='Shakespearean'
                                    %}selected{% endif %}>üìú Shakespearean</option>
                                <option value="Dialect" class="bg-gray-900" {% if user.ai_style=='Dialect' %}selected{%
                                    endif %}>üó£Ô∏è L…ôhc…ô</option>
                                <option value="Short" class="bg-gray-900" {% if user.ai_style=='Short' %}selected{%
                                    endif %}>‚ö°
                                    Qƒ±sa</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7">
                                    </path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- AI Persona Examples -->
                <div class="bg-gradient-to-r from-pink-500/10 to-rose-500/10 rounded-xl p-4 border border-pink-500/20">
                    <p class="text-xs text-white/70 leading-relaxed">
                        <span class="font-semibold text-pink-400">üí° N√ºmun…ôl…ôr:</span><br>
                        <span class="text-white/50">‚Ä¢ B√ºdc…ônin 20%-d…ôn azƒ± qalƒ±b ‚Üí </span><span class="text-white">"S…ôrt
                            Ana" avtomatik aktivl…ô≈üir</span><br>
                        <span class="text-white/50">‚Ä¢ B√ºdc…ônin 50%-d…ôn √ßoxu qalƒ±b ‚Üí </span><span
                            class="text-white">"Professional CFO" aktivl…ô≈üir</span><br>
                        <span class="text-white/50">‚Ä¢ Normal v…ôziyy…ôt ‚Üí </span><span class="text-white">"Dost/Kanka"
                            rejimi</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Premium Exclusive Features -->
        {% if user.is_premium %}
        <!-- Exclusive Themes Section -->
        <div id="themes" class="glass-card p-8 slide-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-yellow-400 to-amber-600 flex items-center justify-center text-2xl shadow-lg shadow-yellow-500/30">
                    üé®
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">Ekskluziv Temalar</h2>
                    <p class="text-white/50 text-sm">Premium √ºzvl…ôrimiz √º√ß√ºn x√ºsusi temalar</p>
                </div>
            </div>

            <div class="space-y-4">
                <p class="text-sm text-white/70 mb-4">
                    Premium √ºzvl…ôrimiz √º√ß√ºn x√ºsusi temalar m√∂vcuddur. ƒ∞st…ôdiyiniz temanƒ± se√ßin.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Gold Theme -->
                    <button type="button" id="theme-gold-btn" onclick="applyPremiumThemeSettings('gold')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-yellow-500/30 hover:border-yellow-500 transition-all group bg-gradient-to-br from-yellow-600/20 to-amber-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-yellow-500/10 to-amber-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">‚ú®</div>
                            <h3 class="text-lg font-bold text-white mb-1">Investor Gold</h3>
                            <p class="text-xs text-white/60">Qƒ±zƒ±l tema</p>
                        </div>
                    </button>

                    <!-- Midnight Theme -->
                    <button type="button" id="theme-midnight-btn" onclick="applyPremiumThemeSettings('midnight')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-gray-700/30 hover:border-gray-600 transition-all group bg-gradient-to-br from-gray-900/20 to-black/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-gray-800/10 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">üåô</div>
                            <h3 class="text-lg font-bold text-white mb-1">Midnight</h3>
                            <p class="text-xs text-white/60">Tam qara tema</p>
                        </div>
                    </button>

                    <!-- Ocean Theme -->
                    <button type="button" id="theme-ocean-btn" onclick="applyPremiumThemeSettings('ocean')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-500 transition-all group bg-gradient-to-br from-cyan-600/20 to-blue-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">üåä</div>
                            <h3 class="text-lg font-bold text-white mb-1">Ocean</h3>
                            <p class="text-xs text-white/60">Okean mavisi</p>
                        </div>
                    </button>

                    <!-- Forest Theme -->
                    <button type="button" id="theme-forest-btn" onclick="applyPremiumThemeSettings('forest')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-green-500/30 hover:border-green-500 transition-all group bg-gradient-to-br from-green-600/20 to-emerald-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-green-500/10 to-emerald-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">üå≤</div>
                            <h3 class="text-lg font-bold text-white mb-1">Forest</h3>
                            <p class="text-xs text-white/60">Me≈ü…ô ya≈üƒ±lƒ±</p>
                        </div>
                    </button>

                    <!-- Sunset Theme -->
                    <button type="button" id="theme-sunset-btn" onclick="applyPremiumThemeSettings('sunset')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-orange-500/30 hover:border-orange-500 transition-all group bg-gradient-to-br from-orange-600/20 to-red-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-red-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">üåÖ</div>
                            <h3 class="text-lg font-bold text-white mb-1">Sunset</h3>
                            <p class="text-xs text-white/60">G√ºn batƒ±mƒ±</p>
                        </div>
                    </button>

                    <!-- Royal Purple Theme -->
                    <button type="button" id="theme-royal-btn" onclick="applyPremiumThemeSettings('royal')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-purple-500/30 hover:border-purple-500 transition-all group bg-gradient-to-br from-purple-600/20 to-indigo-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-indigo-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">üëë</div>
                            <h3 class="text-lg font-bold text-white mb-1">Royal Purple</h3>
                            <p class="text-xs text-white/60">Kral b…ôn√∂v≈ü…ôyi</p>
                        </div>
                    </button>
                </div>

                <!-- Reset to Default -->
                <button type="button" onclick="applyPremiumThemeSettings('default')"
                    class="w-full px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-white text-sm font-medium transition border border-white/10">
                    Standart temaya qayƒ±t
                </button>
            </div>
        </div>

        <!-- Incognito Mode Section -->
        <div class="glass-card p-8 slide-up" style="animation-delay: 0.35s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-gray-400 to-slate-600 flex items-center justify-center text-2xl shadow-lg shadow-gray-500/30">
                    üïµÔ∏è‚Äç‚ôÇÔ∏è
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">M…ôxfilik Modu</h2>
                    <p class="text-white/50 text-sm">B√ºt√ºn m…ôbl…ôƒül…ôri gizl…ôtin</p>
                </div>
            </div>

            <div class="space-y-4">
                <p class="text-sm text-white/70 mb-4">
                    Bank t…ôtbiql…ôrind…ô olan x√ºsusiyy…ôt. Bir d√ºym…ôy…ô basanda b√ºt√ºn m…ôbl…ôƒül…ôr <strong>****</strong>
                    ulduzla gizl…ônir.
                </p>

                <div class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between">
                    <div>
                        <label class="block text-sm font-medium text-white">M…ôxfilik Modu</label>
                        <p class="text-xs text-white/50 mt-1">Varlƒ± adamlarƒ±n ehtiyacƒ± - pulu √ßoxdur, gizl…ôtm…ôk
                            ist…ôyir
                        </p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="incognito-mode-toggle" class="sr-only peer"
                            onchange="toggleIncognitoModeSettings(this.checked)">
                        <div
                            class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gray-700 transition-colors">
                        </div>
                    </label>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Premium Upgrade Card -->
        <div class="relative overflow-hidden rounded-2xl p-6 slide-up group"
            style="animation-delay: 0.25s; cursor: pointer;" onclick="openPremiumModal()">
            <div
                class="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-600 opacity-90 group-hover:scale-105 transition-transform duration-700">
            </div>
            <div
                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 mix-blend-overlay">
            </div>

            <div class="relative z-10 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                        ‚ú® Premium-a Ke√ß
                    </h2>
                    <p class="text-purple-100 text-sm">AI m…ôsl…ôh…ôt√ßi, limitsiz scan v…ô daha √ßoxu!</p>
                </div>
                <div class="text-center bg-white/20 backdrop-blur-sm rounded-xl px-6 py-3 border border-white/30">
                    <span class="block text-3xl font-black text-white drop-shadow-md"><span
                            id="premium-price">4.99</span> <span id="premium-currency">AZN</span></span>
                    <span class="text-xs font-bold text-purple-100 uppercase tracking-wider">/ay</span>
                </div>
            </div>
        </div>

        <!-- Gamification Card -->
        <div class="relative overflow-hidden rounded-2xl p-8 slide-up group" style="animation-delay: 0.3s">
            <!-- Animated Background -->
            <div
                class="absolute inset-0 bg-gradient-to-r from-amber-500 to-orange-600 opacity-90 group-hover:scale-105 transition-transform duration-700">
            </div>
            <div
                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 mix-blend-overlay">
            </div>

            <div class="relative z-10 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                        üî• Login Streak
                        <span class="text-sm bg-white/20 px-2 py-0.5 rounded text-white/90 font-normal">Level {{
                            user.level_title }}</span>
                    </h2>
                    <p class="text-orange-100 text-sm">H…ôr g√ºn daxil olaraq XP qazanƒ±n!</p>
                </div>
                <div class="text-center bg-white/20 backdrop-blur-sm rounded-xl px-6 py-3 border border-white/30">
                    <span class="block text-4xl font-black text-white drop-shadow-md">{{ user.login_streak }}</span>
                    <span class="text-xs font-bold text-orange-100 uppercase tracking-wider">G√ºn</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.35s">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-orange-400 to-red-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-orange-500/30 flex-shrink-0">
                    üó∫Ô∏è
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">X…ôrit…ô</h2>
                    <p class="text-white/50 text-xs sm:text-sm">X…ôrcl…ôrinizin coƒürafi paylanmasƒ±nƒ± g√∂r√ºn</p>
                </div>
            </div>
            <a href="/heatmap"
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <svg class="w-6 h-6 text-orange-400 group-hover:scale-110 transition-transform" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
                    </path>
                </svg>
                <span class="font-medium text-white">X…ôrit…ôni A√ß</span>
                <svg class="w-5 h-5 text-white/50 group-hover:translate-x-1 transition-transform" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>

        <!-- Data Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up" style="animation-delay: 0.4s">
            <button type="button" id="pdf-export-btn" {% if user.is_premium %}
                onclick="window.location.href='/api/export-pdf'" {% else %} onclick="openPremiumModal()" {% endif %}
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <span class="text-2xl group-hover:scale-110 transition-transform">üìÑ</span>
                <span class="font-medium text-white">Aylƒ±q Hesabat (PDF)</span>
                {% if not user.is_premium %}
                <span class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 px-2 py-0.5 rounded-full font-bold">üëë
                    Pro</span>
                {% endif %}
            </button>

            <button type="button" id="xlsx-export-btn" {% if user.is_premium %}
                onclick="window.location.href='/api/export-xlsx'" {% else %} onclick="openPremiumModal()" {% endif %}
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <span class="text-2xl group-hover:scale-110 transition-transform">üìä</span>
                <span class="font-medium text-white">Excel Export (XLSX)</span>
                {% if not user.is_premium %}
                <span class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 px-2 py-0.5 rounded-full font-bold">üëë
                    Pro</span>
                {% endif %}
            </button>
        </div>

        <!-- Hidden Reset Button -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up" style="animation-delay: 0.45s">
            <button type="button" onclick="resetDemoData()"
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-red-500/20 transition-all border border-white/10 hover:border-red-400/40">
                <span class="text-2xl group-hover:scale-110 transition-transform">üßπ</span>
                <span class="font-medium text-white">Demo m…ôlumatlarƒ±nƒ± sƒ±fƒ±rla</span>
            </button>
        </div>

        <!-- Submit Button -->
        <div class="pt-4 slide-up" style="animation-delay: 0.5s">
            <button type="submit"
                class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                <span>Yadda Saxla</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </button>
        </div>

    </form>
</div>

<!-- Currency Conversion Confirmation Modal -->
<!-- Currency Conversion Confirmation Modal Removed -->


<!-- Toast Container -->
<div id="toast-container" class="fixed top-24 right-6 z-50 flex flex-col gap-2 pointer-events-none"></div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/settings.js"></script>
<script>
    // Handle settings form submission
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('settings-form');
        if (form) {
            form.addEventListener('htmx:afterRequest', function (event) {
                console.log('‚öôÔ∏è Settings form response:', event.detail);

                if (event.detail.successful) {
                    try {
                        const response = JSON.parse(event.detail.xhr.response);
                        console.log('‚úÖ Settings updated successfully:', response);

                        if (typeof window.showToast === 'function') {
                            window.showToast(response.message || 'T…ônziml…ôm…ôl…ôr yadda saxlanƒ±ldƒ±', 'success');
                        }

                        // Trigger stats update
                        if (typeof htmx !== 'undefined') {
                            htmx.trigger('body', 'update-stats');
                        }

                        // Reload page after a short delay to show updated settings
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    } catch (e) {
                        console.error('‚ùå Error parsing response:', e);
                        console.error('   Raw response:', event.detail.xhr?.responseText);
                        if (typeof window.showToast === 'function') {
                            window.showToast('T…ônziml…ôm…ôl…ôr yadda saxlanƒ±ldƒ±', 'success');
                        }
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                } else {
                    console.error('‚ùå Settings form submission failed');
                    console.error('   Status:', event.detail.xhr?.status);
                    console.error('   Response:', event.detail.xhr?.responseText);
                    try {
                        const response = JSON.parse(event.detail.xhr.response);
                        if (typeof window.showToast === 'function') {
                            window.showToast(response.error || 'X…ôta ba≈ü verdi', 'error');
                        }
                    } catch (e) {
                        console.error('   Error parsing error response:', e);
                        if (typeof window.showToast === 'function') {
                            window.showToast('X…ôta ba≈ü verdi', 'error');
                        }
                    }
                }
            });

            form.addEventListener('htmx:beforeRequest', function (event) {
                console.log('‚öôÔ∏è Settings form submitting...');
                const formData = new FormData(form);
                console.log('   Form data:');
                for (let [key, value] of formData.entries()) {
                    console.log(`     ${key}: ${value}`);
                }
            });
        }
    });
</script>
{% endblock %}