{% extends "base.html" %}

{% block title %}Settings - FinMate AI{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-2 sm:px-4 py-4 sm:py-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 sm:mb-10 slide-up gap-3">
        <div class="flex-1 min-w-0">
            <h1
                class="text-2xl sm:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-white to-white/70">
                TÉ™nzimlÉ™mÉ™lÉ™r
            </h1>
            <p class="text-white/60 mt-1 sm:mt-2 text-sm sm:text-lg">ÅÉ™xsi seÃ§imlÉ™rinizi vÉ™ bÃ¼dcÉ™nizi idarÉ™ edin</p>
        </div>
        <a href="/"
            class="group flex items-center gap-2 px-3 sm:px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-white transition-all hover:scale-105 text-sm sm:text-base">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 group-hover:-translate-x-1 transition-transform" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18">
                </path>
            </svg>
            <span>Geri</span>
        </a>
    </div>

    <!-- Settings Form -->
    <form hx-post="/api/settings" hx-swap="none" class="space-y-8">

        <!-- Budget Section -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.1s">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-green-400 to-emerald-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-green-500/30 flex-shrink-0">
                    ğŸ’°
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">BÃ¼dcÉ™ Ä°darÉ™etmÉ™si</h2>
                    <p class="text-white/50 text-xs sm:text-sm">AylÄ±q vÉ™ gÃ¼ndÉ™lik limitlÉ™rinizi tÉ™yin edin</p>
                </div>
            </div>

            <div class="space-y-8">
                <!-- Monthly Budget Slider -->
                <div>
                    <div class="flex justify-between items-end mb-3 sm:mb-4">
                        <label class="text-xs sm:text-sm font-medium text-white/80">AylÄ±q BÃ¼dcÉ™</label>
                        <div class="text-right">
                            <span id="budget-display" class="text-2xl sm:text-3xl font-bold text-green-400">{{
                                "%.0f"|format(user.monthly_budget) }}</span>
                            <span class="text-white/60 text-xs sm:text-sm font-medium">AZN</span>
                        </div>
                    </div>
                    <div class="relative h-2 bg-white/10 rounded-full">
                        <input type="range" name="monthly_budget" min="100" max="5000" step="50"
                            value="{{ user.monthly_budget }}"
                            class="absolute w-full h-full opacity-0 cursor-pointer z-10"
                            oninput="updateBudget(this.value)">
                        <div id="budget-progress"
                            class="absolute top-0 left-0 h-full bg-gradient-to-r from-green-400 to-emerald-500 rounded-full transition-all duration-150"
                            style="width: {{ (user.monthly_budget / 5000) * 100 }}%"></div>
                        <div id="budget-thumb"
                            class="absolute top-1/2 -mt-3 w-6 h-6 bg-white rounded-full shadow-lg shadow-black/50 transition-all duration-150 pointer-events-none"
                            style="left: {{ (user.monthly_budget / 5000) * 100 }}%; transform: translateX(-50%) translateY(-50%);">
                        </div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-white/40 font-medium">
                        <span>100 â‚¼</span>
                        <span>5000 â‚¼</span>
                    </div>
                </div>

                <!-- Daily Limit Input -->
                <div class="bg-white/5 rounded-xl p-4 border border-white/10 hover:border-white/20 transition-colors">
                    <label class="block text-sm font-medium text-white/80 mb-2">
                        GÃ¼ndÉ™lik XÉ™rc Limiti (Opsional)
                    </label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-white/40">â‚¼</span>
                        <input type="number" name="daily_budget_limit"
                            value="{{ user.daily_budget_limit if user.daily_budget_limit else '' }}"
                            placeholder="Limit yoxdur"
                            class="w-full bg-black/20 text-white pl-10 pr-4 py-3 rounded-lg border border-white/10 focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none transition-all placeholder-white/20">
                    </div>
                    <p class="text-xs text-white/40 mt-2 flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Limit keÃ§ildikdÉ™ xÉ™bÉ™rdarlÄ±q alacaqsÄ±nÄ±z
                    </p>
                </div>
            </div>
        </div>

        <!-- Preferences Section -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.2s">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-purple-400 to-indigo-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-indigo-500/30 flex-shrink-0">
                    âš™ï¸
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">TÉ™rcihlÉ™r</h2>
                    <p class="text-white/50 text-xs sm:text-sm">TÉ™tbiqi Ã¶zÃ¼nÃ¼zÉ™ uyÄŸunlaÅŸdÄ±rÄ±n</p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- Language -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-white/80 mb-2">Dil SeÃ§imi</label>
                        <div class="relative">
                            <select name="preferred_language"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="az" class="bg-gray-900" {% if user.preferred_language=='az' %}selected{%
                                    endif %}>ğŸ‡¦ğŸ‡¿ AzÉ™rbaycan dili</option>
                                <option value="en" class="bg-gray-900" {% if user.preferred_language=='en' %}selected{%
                                    endif %}>ğŸ‡ºğŸ‡¸ English</option>
                                <option value="ru" class="bg-gray-900" {% if user.preferred_language=='ru' %}selected{%
                                    endif %}>ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-white/80 mb-2">Valyuta</label>
                        <div class="relative">
                            {% set curr = user.currency or 'AZN' %}
                            <select name="currency"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="AZN" class="bg-gray-900" {% if curr=='AZN' %}selected{% endif %}>ğŸ‡¦ğŸ‡¿ AZN
                                </option>
                                <option value="USD" class="bg-gray-900" {% if curr=='USD' %}selected{% endif %}>ğŸ‡ºğŸ‡¸ USD
                                </option>
                                <option value="EUR" class="bg-gray-900" {% if curr=='EUR' %}selected{% endif %}>ğŸ‡ªğŸ‡º EUR
                                </option>
                                <option value="TRY" class="bg-gray-900" {% if curr=='TRY' %}selected{% endif %}>ğŸ‡¹ğŸ‡· TRY
                                </option>
                                <option value="RUB" class="bg-gray-900" {% if curr=='RUB' %}selected{% endif %}>ğŸ‡·ğŸ‡º RUB
                                </option>
                                <option value="GBP" class="bg-gray-900" {% if curr=='GBP' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ GBP
                                </option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        <p class="text-xs text-white/40 mt-2">Æsas baza valyutasÄ± AZN qalÄ±r, gÃ¶stÉ™rim Ã¼Ã§Ã¼n seÃ§in.</p>
                    </div>

                    <!-- Voice Toggle -->
                    <div
                        class="bg-white/5 rounded-xl p-3 sm:p-4 border border-white/10 flex items-center justify-between gap-3">
                        <div class="flex-1 min-w-0">
                            <label class="block text-xs sm:text-sm font-medium text-white">SÉ™sli ÆmrlÉ™r</label>
                            <p class="text-xs text-white/50 mt-1">Mikrofon ilÉ™ xÉ™rc É™lavÉ™ et</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="hidden" name="voice_enabled" value="false">
                            <input type="checkbox" name="voice_enabled" value="true" {% if user.voice_enabled
                                %}checked{% endif %} class="sr-only peer">
                            <div
                                class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-500 transition-colors">
                            </div>
                        </label>
                    </div>

                    <!-- Voice Mode Toggle (TTS) -->
                    <div class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between">
                        <div>
                            <label class="block text-sm font-medium text-white">ğŸ”Š SÉ™slÉ™ndirmÉ™ Rejimi</label>
                            <p class="text-xs text-white/50 mt-1">MÉ™tnlÉ™ri sÉ™sli oxumaq Ã¼Ã§Ã¼n</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="voice-mode-toggle" class="sr-only peer"
                                onchange="toggleVoiceMode(this.checked)">
                            <div
                                class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-500 transition-colors">
                            </div>
                        </label>
                    </div>

                    <!-- Readability Mode Toggle (NEW) -->
                    <div class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between">
                        <div>
                            <label class="block text-sm font-medium text-white">ğŸ‘ï¸ OxunaqlÄ±lÄ±q Rejimi</label>
                            <p class="text-xs text-white/50 mt-1">GÃ¶zÃ¼ zÉ™if gÃ¶rÉ™nlÉ™r Ã¼Ã§Ã¼n bÃ¶yÃ¼k yazÄ±</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="hidden" name="readability_mode" value="false">
                            <input type="checkbox" id="readability-mode-toggle" name="readability_mode" value="true" {%
                                if user.readability_mode %}checked{% endif %} class="sr-only peer"
                                onchange="toggleReadabilityMode(this.checked)">
                            <div
                                class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-green-500 transition-colors">
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Persona Customization Section -->
        <div class="glass-card p-8 slide-up" style="animation-delay: 0.25s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-pink-400 to-rose-600 flex items-center justify-center text-2xl shadow-lg shadow-pink-500/30">
                    ğŸ¤–
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">AI Xarakteri</h2>
                    <p class="text-white/50 text-sm">MaliyyÉ™ kÃ¶mÉ™kÃ§inizi Ã¶zÃ¼nÃ¼zÉ™ uyÄŸunlaÅŸdÄ±rÄ±n</p>
                </div>
            </div>

            <div class="space-y-6">
                <!-- AI Persona Mode -->
                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">Persona Rejimi</label>
                    <div class="relative">
                        <select name="ai_persona_mode"
                            class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                            <option value="Auto" class="bg-gray-900" {% if user.ai_persona_mode=='Auto' %}selected{%
                                endif %}>ğŸ­ Avtomatik (MÉ™slÉ™hÉ™tli)</option>
                            <option value="Manual" class="bg-gray-900" {% if user.ai_persona_mode=='Manual' %}selected{%
                                endif %}>âœï¸ Æl ilÉ™ (Manual)</option>
                        </select>
                        <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                    <p class="text-xs text-white/40 mt-2">
                        <svg class="w-3 h-3 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Avtomatik rejim bÃ¼dcÉ™nizÉ™ É™sasÉ™n AI xarakterini dÉ™yiÅŸir
                    </p>
                </div>

                <!-- AI Name -->
                <div>
                    <label class="block text-sm font-medium text-white/80 mb-2">AI AdÄ±</label>
                    <input type="text" name="ai_name" value="{{ user.ai_name or 'FinMate' }}" placeholder="FinMate"
                        class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none transition-all placeholder-white/20">
                </div>

                <!-- Manual Mode Settings (only shown if Manual selected) -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- AI Attitude -->
                    <div>
                        <label class="block text-sm font-medium text-white/80 mb-2">MÃ¼nasibÉ™t</label>
                        <div class="relative">
                            <select name="ai_attitude"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="Professional" class="bg-gray-900" {% if user.ai_attitude=='Professional'
                                    %}selected{% endif %}>ğŸ’¼ Professional</option>
                                <option value="Strict" class="bg-gray-900" {% if user.ai_attitude=='Strict' %}selected{%
                                    endif %}>ğŸ˜¤ SÉ™rt Ana</option>
                                <option value="Funny" class="bg-gray-900" {% if user.ai_attitude=='Funny' %}selected{%
                                    endif %}>ğŸ˜„ ZarafatcÄ±l</option>
                                <option value="Sarcastic" class="bg-gray-900" {% if user.ai_attitude=='Sarcastic'
                                    %}selected{% endif %}>ğŸ˜ Sarkastik</option>
                                <option value="Supportive" class="bg-gray-900" {% if user.ai_attitude=='Supportive'
                                    %}selected{% endif %}>ğŸ¤— DÉ™stÉ™klÉ™yici</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- AI Style -->
                    <div>
                        <label class="block text-sm font-medium text-white/80 mb-2">DanÄ±ÅŸÄ±q TÉ™rzi</label>
                        <div class="relative">
                            <select name="ai_style"
                                class="w-full bg-black/20 text-white px-4 py-3 rounded-xl border border-white/10 focus:border-pink-500 focus:ring-1 focus:ring-pink-500 outline-none appearance-none cursor-pointer transition-all">
                                <option value="Formal" class="bg-gray-900" {% if user.ai_style=='Formal' %}selected{%
                                    endif %}>ğŸ© RÉ™smi</option>
                                <option value="Slang" class="bg-gray-900" {% if user.ai_style=='Slang' %}selected{%
                                    endif %}>ğŸ˜ Jarqon / Slang</option>
                                <option value="Shakespearean" class="bg-gray-900" {% if user.ai_style=='Shakespearean'
                                    %}selected{% endif %}>ğŸ“œ Shakespearean</option>
                                <option value="Dialect" class="bg-gray-900" {% if user.ai_style=='Dialect' %}selected{%
                                    endif %}>ğŸ—£ï¸ LÉ™hcÉ™</option>
                                <option value="Short" class="bg-gray-900" {% if user.ai_style=='Short' %}selected{%
                                    endif %}>âš¡ QÄ±sa</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-white/50">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Persona Examples -->
                <div class="bg-gradient-to-r from-pink-500/10 to-rose-500/10 rounded-xl p-4 border border-pink-500/20">
                    <p class="text-xs text-white/70 leading-relaxed">
                        <span class="font-semibold text-pink-400">ğŸ’¡ NÃ¼munÉ™lÉ™r:</span><br>
                        <span class="text-white/50">â€¢ BÃ¼dcÉ™nin 20%-dÉ™n azÄ± qalÄ±b â†’ </span><span class="text-white">"SÉ™rt
                            Ana" avtomatik aktivlÉ™ÅŸir</span><br>
                        <span class="text-white/50">â€¢ BÃ¼dcÉ™nin 50%-dÉ™n Ã§oxu qalÄ±b â†’ </span><span
                            class="text-white">"Professional CFO" aktivlÉ™ÅŸir</span><br>
                        <span class="text-white/50">â€¢ Normal vÉ™ziyyÉ™t â†’ </span><span class="text-white">"Dost/Kanka"
                            rejimi</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Premium Exclusive Features -->
        {% if user.is_premium %}
        <!-- Exclusive Themes Section -->
        <div id="themes" class="glass-card p-8 slide-up" style="animation-delay: 0.3s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-yellow-400 to-amber-600 flex items-center justify-center text-2xl shadow-lg shadow-yellow-500/30">
                    ğŸ¨
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">Ekskluziv Temalar</h2>
                    <p class="text-white/50 text-sm">Premium Ã¼zvlÉ™rimiz Ã¼Ã§Ã¼n xÃ¼susi temalar</p>
                </div>
            </div>

            <div class="space-y-4">
                <p class="text-sm text-white/70 mb-4">
                    Premium Ã¼zvlÉ™rimiz Ã¼Ã§Ã¼n xÃ¼susi temalar mÃ¶vcuddur. Ä°stÉ™diyiniz temanÄ± seÃ§in.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Gold Theme -->
                    <button type="button" id="theme-gold-btn" onclick="applyPremiumThemeSettings('gold')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-yellow-500/30 hover:border-yellow-500 transition-all group bg-gradient-to-br from-yellow-600/20 to-amber-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-yellow-500/10 to-amber-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">âœ¨</div>
                            <h3 class="text-lg font-bold text-white mb-1">Investor Gold</h3>
                            <p class="text-xs text-white/60">QÄ±zÄ±l tema</p>
                        </div>
                    </button>

                    <!-- Midnight Theme -->
                    <button type="button" id="theme-midnight-btn" onclick="applyPremiumThemeSettings('midnight')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-gray-700/30 hover:border-gray-600 transition-all group bg-gradient-to-br from-gray-900/20 to-black/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-gray-800/10 to-black/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">ğŸŒ™</div>
                            <h3 class="text-lg font-bold text-white mb-1">Midnight</h3>
                            <p class="text-xs text-white/60">Tam qara tema</p>
                        </div>
                    </button>

                    <!-- Ocean Theme -->
                    <button type="button" id="theme-ocean-btn" onclick="applyPremiumThemeSettings('ocean')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-cyan-500/30 hover:border-cyan-500 transition-all group bg-gradient-to-br from-cyan-600/20 to-blue-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-cyan-500/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">ğŸŒŠ</div>
                            <h3 class="text-lg font-bold text-white mb-1">Ocean</h3>
                            <p class="text-xs text-white/60">Okean mavisi</p>
                        </div>
                    </button>

                    <!-- Forest Theme -->
                    <button type="button" id="theme-forest-btn" onclick="applyPremiumThemeSettings('forest')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-green-500/30 hover:border-green-500 transition-all group bg-gradient-to-br from-green-600/20 to-emerald-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-green-500/10 to-emerald-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">ğŸŒ²</div>
                            <h3 class="text-lg font-bold text-white mb-1">Forest</h3>
                            <p class="text-xs text-white/60">MeÅŸÉ™ yaÅŸÄ±lÄ±</p>
                        </div>
                    </button>

                    <!-- Sunset Theme -->
                    <button type="button" id="theme-sunset-btn" onclick="applyPremiumThemeSettings('sunset')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-orange-500/30 hover:border-orange-500 transition-all group bg-gradient-to-br from-orange-600/20 to-red-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-red-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">ğŸŒ…</div>
                            <h3 class="text-lg font-bold text-white mb-1">Sunset</h3>
                            <p class="text-xs text-white/60">GÃ¼n batÄ±mÄ±</p>
                        </div>
                    </button>

                    <!-- Royal Purple Theme -->
                    <button type="button" id="theme-royal-btn" onclick="applyPremiumThemeSettings('royal')"
                        class="relative overflow-hidden rounded-xl p-6 border-2 border-purple-500/30 hover:border-purple-500 transition-all group bg-gradient-to-br from-purple-600/20 to-indigo-700/20">
                        <div
                            class="absolute inset-0 bg-gradient-to-br from-purple-500/10 to-indigo-600/10 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <div class="relative z-10 text-center">
                            <div class="text-4xl mb-2">ğŸ‘‘</div>
                            <h3 class="text-lg font-bold text-white mb-1">Royal Purple</h3>
                            <p class="text-xs text-white/60">Kral bÉ™nÃ¶vÅŸÉ™yi</p>
                        </div>
                    </button>
                </div>

                <!-- Reset to Default -->
                <button type="button" onclick="applyPremiumThemeSettings('default')"
                    class="w-full px-4 py-2 bg-white/5 hover:bg-white/10 rounded-lg text-white text-sm font-medium transition border border-white/10">
                    Standart temaya qayÄ±t
                </button>
            </div>
        </div>

        <!-- Incognito Mode Section -->
        <div class="glass-card p-8 slide-up" style="animation-delay: 0.35s">
            <div class="flex items-center gap-4 mb-6">
                <div
                    class="w-12 h-12 rounded-2xl bg-gradient-to-br from-gray-400 to-slate-600 flex items-center justify-center text-2xl shadow-lg shadow-gray-500/30">
                    ğŸ•µï¸â€â™‚ï¸
                </div>
                <div>
                    <h2 class="text-xl font-bold text-white">MÉ™xfilik Modu</h2>
                    <p class="text-white/50 text-sm">BÃ¼tÃ¼n mÉ™blÉ™ÄŸlÉ™ri gizlÉ™tin</p>
                </div>
            </div>

            <div class="space-y-4">
                <p class="text-sm text-white/70 mb-4">
                    Bank tÉ™tbiqlÉ™rindÉ™ olan xÃ¼susiyyÉ™t. Bir dÃ¼ymÉ™yÉ™ basanda bÃ¼tÃ¼n mÉ™blÉ™ÄŸlÉ™r <strong>****</strong>
                    ulduzla gizlÉ™nir.
                </p>

                <div class="bg-white/5 rounded-xl p-4 border border-white/10 flex items-center justify-between">
                    <div>
                        <label class="block text-sm font-medium text-white">MÉ™xfilik Modu</label>
                        <p class="text-xs text-white/50 mt-1">VarlÄ± adamlarÄ±n ehtiyacÄ± - pulu Ã§oxdur, gizlÉ™tmÉ™k istÉ™yir
                        </p>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="incognito-mode-toggle" class="sr-only peer"
                            onchange="toggleIncognitoModeSettings(this.checked)">
                        <div
                            class="w-14 h-7 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gray-700 transition-colors">
                        </div>
                    </label>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Premium Upgrade Card -->
        <div class="relative overflow-hidden rounded-2xl p-6 slide-up group"
            style="animation-delay: 0.25s; cursor: pointer;" onclick="openPremiumModal()">
            <div
                class="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-600 opacity-90 group-hover:scale-105 transition-transform duration-700">
            </div>
            <div
                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20 mix-blend-overlay">
            </div>

            <div class="relative z-10 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                        âœ¨ Premium-a KeÃ§
                    </h2>
                    <p class="text-purple-100 text-sm">AI mÉ™slÉ™hÉ™tÃ§i, limitsiz scan vÉ™ daha Ã§oxu!</p>
                </div>
                <div class="text-center bg-white/20 backdrop-blur-sm rounded-xl px-6 py-3 border border-white/30">
                    <span class="block text-3xl font-black text-white drop-shadow-md">4.99 â‚¼</span>
                    <span class="text-xs font-bold text-purple-100 uppercase tracking-wider">/ay</span>
                </div>
            </div>
        </div>

        <!-- Gamification Card -->
        <div class="relative overflow-hidden rounded-2xl p-8 slide-up group" style="animation-delay: 0.3s">
            <!-- Animated Background -->
            <div
                class="absolute inset-0 bg-gradient-to-r from-amber-500 to-orange-600 opacity-90 group-hover:scale-105 transition-transform duration-700">
            </div>
            <div
                class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 mix-blend-overlay">
            </div>

            <div class="relative z-10 flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-bold text-white mb-1 flex items-center gap-2">
                        ğŸ”¥ Login Streak
                        <span class="text-sm bg-white/20 px-2 py-0.5 rounded text-white/90 font-normal">Level {{
                            user.level_title }}</span>
                    </h2>
                    <p class="text-orange-100 text-sm">HÉ™r gÃ¼n daxil olaraq XP qazanÄ±n!</p>
                </div>
                <div class="text-center bg-white/20 backdrop-blur-sm rounded-xl px-6 py-3 border border-white/30">
                    <span class="block text-4xl font-black text-white drop-shadow-md">{{ user.login_streak }}</span>
                    <span class="text-xs font-bold text-orange-100 uppercase tracking-wider">GÃ¼n</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-card p-4 sm:p-6 md:p-8 slide-up" style="animation-delay: 0.35s">
            <div class="flex items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl sm:rounded-2xl bg-gradient-to-br from-orange-400 to-red-600 flex items-center justify-center text-xl sm:text-2xl shadow-lg shadow-orange-500/30 flex-shrink-0">
                    ğŸ—ºï¸
                </div>
                <div class="min-w-0 flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-white">XÉ™ritÉ™</h2>
                    <p class="text-white/50 text-xs sm:text-sm">XÉ™rclÉ™rinizin coÄŸrafi paylanmasÄ±nÄ± gÃ¶rÃ¼n</p>
                </div>
            </div>
            <a href="/heatmap"
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <svg class="w-6 h-6 text-orange-400 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
                    </path>
                </svg>
                <span class="font-medium text-white">XÉ™ritÉ™ni AÃ§</span>
                <svg class="w-5 h-5 text-white/50 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>

        <!-- Data Actions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up" style="animation-delay: 0.4s">
            <button type="button" id="pdf-export-btn" {% if user.is_premium %}
                onclick="window.location.href='/api/export-pdf'" {% else %} onclick="openPremiumModal()" {% endif %}
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <span class="text-2xl group-hover:scale-110 transition-transform">ğŸ“„</span>
                <span class="font-medium text-white">AylÄ±q Hesabat (PDF)</span>
                {% if not user.is_premium %}
                <span class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 px-2 py-0.5 rounded-full font-bold">ğŸ‘‘
                    Pro</span>
                {% endif %}
            </button>

            <button type="button" id="xlsx-export-btn" {% if user.is_premium %}
                onclick="window.location.href='/api/export-xlsx'" {% else %} onclick="openPremiumModal()" {% endif %}
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-white/10 transition-all border border-white/10 hover:border-white/30 cursor-pointer">
                <span class="text-2xl group-hover:scale-110 transition-transform">ğŸ“Š</span>
                <span class="font-medium text-white">Excel Export (XLSX)</span>
                {% if not user.is_premium %}
                <span class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 px-2 py-0.5 rounded-full font-bold">ğŸ‘‘
                    Pro</span>
                {% endif %}
            </button>
        </div>

        <!-- Hidden Reset Button -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 slide-up" style="animation-delay: 0.45s">
            <button type="button" onclick="resetDemoData()"
                class="group glass-card p-4 flex items-center justify-center gap-3 hover:bg-red-500/20 transition-all border border-white/10 hover:border-red-400/40">
                <span class="text-2xl group-hover:scale-110 transition-transform">ğŸ§¹</span>
                <span class="font-medium text-white">Demo mÉ™lumatlarÄ±nÄ± sÄ±fÄ±rla</span>
            </button>
        </div>

        <!-- Submit Button -->
        <div class="pt-4 slide-up" style="animation-delay: 0.5s">
            <button type="submit"
                class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                <span>Yadda Saxla</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </button>
        </div>

    </form>
</div>

<!-- Toast Container -->
<div id="toast-container" class="fixed top-24 right-6 z-50 flex flex-col gap-2 pointer-events-none"></div>

<script>
    // Make all functions global
    (function () {
        'use strict';

        // Budget Slider Logic
        window.updateBudget = function (val) {
            const display = document.getElementById('budget-display');
            const progress = document.getElementById('budget-progress');
            const thumb = document.getElementById('budget-thumb');

            if (display) display.textContent = val;
            if (progress && thumb) {
                const percentage = (val / 5000) * 100;
                progress.style.width = percentage + '%';
                thumb.style.left = percentage + '%';
            }
        };

        // Toast Notification System
        window.showToast = function (message, type = 'success') {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');

            const styles = type === 'success'
                ? 'bg-green-500/90 border-green-400/50 shadow-green-500/20'
                : type === 'error'
                    ? 'bg-red-500/90 border-red-400/50 shadow-red-500/20'
                    : 'bg-blue-500/90 border-blue-400/50 shadow-blue-500/20';

            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸';

            toast.className = `pointer-events-auto backdrop-blur-md text-white px-6 py-4 rounded-xl shadow-lg border flex items-center gap-3 transform transition-all duration-500 translate-x-full ${styles}`;
            toast.innerHTML = `
                <span class="text-xl">${icon}</span>
                <span class="font-medium">${message}</span>
            `;

            container.appendChild(toast);

            // Animate in
            requestAnimationFrame(() => {
                toast.classList.remove('translate-x-full');
            });

            // Remove after 3 seconds
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        };

        // HTMX Response Handling
        document.body.addEventListener('htmx:afterRequest', function (event) {
            if (event.detail && event.detail.target && event.detail.target.tagName === 'FORM') {
                if (event.detail.successful) {
                    try {
                        const response = JSON.parse(event.detail.xhr.response);
                        if (response.success) {
                            window.showToast(response.message || 'TÉ™nzimlÉ™mÉ™lÉ™r yadda saxlanÄ±ldÄ±!');
                        } else {
                            window.showToast(response.error || 'XÉ™ta baÅŸ verdi', 'error');
                        }
                    } catch (e) {
                        window.showToast('TÉ™nzimlÉ™mÉ™lÉ™r yadda saxlanÄ±ldÄ±!', 'success');
                    }
                } else {
                    window.showToast('Server xÉ™tasÄ± baÅŸ verdi', 'error');
                }
            }
        });

        // Reset Demo Data
        window.resetDemoData = async function () {
            if (!confirm('Demo mÉ™lumatlarÄ±nÄ± sÄ±fÄ±rlamaq istÉ™yirsÉ™n? BÃ¼tÃ¼n cari mÉ™lumatlar silinÉ™cÉ™k.')) return;
            try {
                const res = await fetch('/api/reset-demo', { method: 'POST' });
                const data = await res.json();
                if (data.success) {
                    window.showToast('Demo mÉ™lumatlarÄ± yenilÉ™ndi, sÉ™hifÉ™ni yenilÉ™!');
                } else {
                    window.showToast(data.error || 'SÄ±fÄ±rlama alÄ±nmadÄ±', 'error');
                }
            } catch (err) {
                window.showToast('ÅÉ™bÉ™kÉ™ xÉ™tasÄ±', 'error');
            }
        };

        // Update Theme Buttons
        window.updateThemeButtons = function (activeTheme) {
            const buttons = {
                'gold': 'theme-gold-btn',
                'midnight': 'theme-midnight-btn',
                'ocean': 'theme-ocean-btn',
                'forest': 'theme-forest-btn',
                'sunset': 'theme-sunset-btn',
                'royal': 'theme-royal-btn'
            };

            const borderClasses = {
                'gold': 'border-yellow-500 ring-2 ring-yellow-500/50',
                'midnight': 'border-gray-500 ring-2 ring-gray-500/50',
                'ocean': 'border-cyan-500 ring-2 ring-cyan-500/50',
                'forest': 'border-green-500 ring-2 ring-green-500/50',
                'sunset': 'border-orange-500 ring-2 ring-orange-500/50',
                'royal': 'border-purple-500 ring-2 ring-purple-500/50'
            };

            // Remove all active states
            Object.values(buttons).forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.classList.remove('border-yellow-500', 'ring-2', 'ring-yellow-500/50',
                        'border-gray-500', 'ring-gray-500/50',
                        'border-cyan-500', 'ring-cyan-500/50',
                        'border-green-500', 'ring-green-500/50',
                        'border-orange-500', 'ring-orange-500/50',
                        'border-purple-500', 'ring-purple-500/50');
                }
            });

            // Add active state to selected theme
            if (activeTheme !== 'default' && buttons[activeTheme]) {
                const btn = document.getElementById(buttons[activeTheme]);
                if (btn && borderClasses[activeTheme]) {
                    const classes = borderClasses[activeTheme].split(' ');
                    classes.forEach(cls => btn.classList.add(cls));
                }
            }
        };

        // Premium Theme Switching (Settings-specific wrapper)
        window.applyPremiumThemeSettings = function (theme) {
            console.log('Settings: Applying theme:', theme);

            // Call global function if available
            if (typeof window.applyPremiumTheme === 'function') {
                window.applyPremiumTheme(theme);
            } else {
                // Fallback: apply theme directly
                const body = document.body;
                const html = document.documentElement;
                const themes = ['theme-gold', 'theme-midnight', 'theme-ocean', 'theme-forest', 'theme-sunset', 'theme-royal'];

                themes.forEach(t => {
                    body.classList.remove(t);
                    html.classList.remove(t);
                });

                const themeMap = {
                    'gold': 'theme-gold',
                    'midnight': 'theme-midnight',
                    'ocean': 'theme-ocean',
                    'forest': 'theme-forest',
                    'sunset': 'theme-sunset',
                    'royal': 'theme-royal'
                };

                if (theme && theme !== 'default' && themeMap[theme]) {
                    body.classList.add(themeMap[theme]);
                    html.classList.add(themeMap[theme]);
                    localStorage.setItem('premium-theme', theme);
                } else {
                    localStorage.removeItem('premium-theme');
                    // When returning to default, set theme to 'light' for pink color scheme
                    html.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            }

            const themeNames = {
                'gold': 'âœ¨ Investor Gold',
                'midnight': 'ğŸŒ™ Midnight',
                'ocean': 'ğŸŒŠ Ocean',
                'forest': 'ğŸŒ² Forest',
                'sunset': 'ğŸŒ… Sunset',
                'royal': 'ğŸ‘‘ Royal Purple',
                'default': 'Standart (Ã‡É™hrayÄ±)'
            };

            const themeName = themeNames[theme] || 'Standart';
            if (theme !== 'default') {
                window.showToast(`${themeName} temaya keÃ§ildi!`, 'success');
            } else {
                window.showToast('Standart Ã§É™hrayÄ± temaya qayÄ±dÄ±ldÄ±', 'success');
            }

            // Update button states
            window.updateThemeButtons(theme);
        };

        // Incognito Mode Toggle (Settings-specific wrapper)
        window.toggleIncognitoModeSettings = function (enabled) {
            if (typeof window.toggleIncognitoMode === 'function') {
                window.toggleIncognitoMode(enabled);
                if (enabled) {
                    window.showToast('ğŸ•µï¸â€â™‚ï¸ MÉ™xfilik modu aktivlÉ™ÅŸdirildi', 'success');
                } else {
                    window.showToast('MÉ™xfilik modu deaktivlÉ™ÅŸdirildi', 'success');
                }
            } else {
                window.showToast('MÉ™xfilik modu funksiyasÄ± yÃ¼klÉ™nmÉ™yib', 'error');
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Load premium theme
            const savedTheme = localStorage.getItem('premium-theme');
            const validThemes = ['gold', 'midnight', 'ocean', 'forest', 'sunset', 'royal'];

            // Wait for theme.js to load
            setTimeout(() => {
                if (savedTheme && validThemes.includes(savedTheme)) {
                    // Apply theme using global function
                    if (typeof window.applyPremiumTheme === 'function') {
                        window.applyPremiumTheme(savedTheme);
                    } else {
                        window.applyPremiumThemeSettings(savedTheme);
                    }
                    window.updateThemeButtons(savedTheme);
                } else {
                    window.updateThemeButtons('default');
                }
            }, 200);

            // Load incognito mode
            const isIncognito = localStorage.getItem('incognito-mode') === 'enabled';
            const toggle = document.getElementById('incognito-mode-toggle');
            if (toggle) {
                toggle.checked = isIncognito;
                if (isIncognito && typeof window.toggleIncognitoMode === 'function') {
                    setTimeout(() => {
                        window.toggleIncognitoMode(true);
                    }, 300);
                }
            }

            // Listen for theme changes
            window.addEventListener('themeChanged', (event) => {
                const theme = event.detail.theme;
                window.updateThemeButtons(theme === 'default' ? 'default' : theme);
            });
        });
    })();
</script>
{% endblock %}