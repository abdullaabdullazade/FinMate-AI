{% extends "base.html" %}

{% block title %}X…ôrit…ô - FinMate AI{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="/static/css/heatmap.css">
<script id="map-points-data" type="application/json">{{ points | tojson | safe }}</script>
{% endblock %}

{% block content %}
<div class="glass-card p-6 mb-6 slide-up">
    <div class="flex items-center justify-between mb-4">
        <div>
            <h2 class="text-2xl font-bold text-white">üó∫Ô∏è X…ôrc X…ôrit…ôsi</h2>
            <p class="text-white/70 text-sm">X…ôrcl…ôrinizin GPS koordinatlarƒ±</p>
        </div>
        <div class="text-right">
            <p class="text-sm text-white/60">√úmumi n√∂qt…ô</p>
            <p class="text-2xl font-bold text-white">{{ points|length }}</p>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Legend -->
    <div class="mt-4 flex items-center gap-4 text-sm text-white/70">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-red-500 rounded-full border-2 border-white"></div>
            <span>X…ôrc n√∂qt…ôsi</span>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-white/50">|</span>
            <span>{{ points|length }} merchant</span>
        </div>
    </div>
</div>

<!-- Stats Card -->
<div class="glass-card p-6 slide-up" style="animation-delay: 0.1s">
    <h3 class="text-lg font-bold text-white mb-4">üìä X…ôrc Statistikasƒ±</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% set total_amount = points|sum(attribute='amount') %}
        {% set categories = points|map(attribute='category')|unique|list %}

        <div class="bg-white/5 rounded-xl p-4 text-center">
            <p class="text-white/60 text-xs mb-1">√úmumi</p>
            <p class="text-2xl font-bold text-white">{{ "%.0f"|format(total_amount) }} ‚Çº</p>
        </div>
        <div class="bg-white/5 rounded-xl p-4 text-center">
            <p class="text-white/60 text-xs mb-1">N√∂qt…ôl…ôr</p>
            <p class="text-2xl font-bold text-white">{{ points|length }}</p>
        </div>
        <div class="bg-white/5 rounded-xl p-4 text-center">
            <p class="text-white/60 text-xs mb-1">Kateqoriya</p>
            <p class="text-2xl font-bold text-white">{{ categories|length }}</p>
        </div>
        <div class="bg-white/5 rounded-xl p-4 text-center">
            <p class="text-white/60 text-xs mb-1">Ortalama</p>
            <p class="text-2xl font-bold text-white">{{ "%.0f"|format(total_amount / points|length if points|length > 0
                else 0) }} ‚Çº</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="/static/js/heatmap.js"></script>
{% endblock %}
